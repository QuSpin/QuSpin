<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lanczos module: time-evolution and ground state search &mdash; QuSpin 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../static/css/sphinx_rtd_size.css?v=f26ae176" />
      <link rel="stylesheet" type="text/css" href="../static/css/py_class_property_fix.css?v=faf79ccd" />

  
  <!--[if lt IE 9]>
    <script src="../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../static/jquery.js?v=5d32c60e"></script>
        <script src="../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../static/documentation_options.js?v=8d563738"></script>
        <script src="../static/doctools.js?v=9a2dae69"></script>
        <script src="../static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            QuSpin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">QuSpin (public API)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basis.html">Basis module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.basis</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operators.html">Operators module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.operators</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">Tools module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.tools</span></code>)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html#basics-of-command-line-use">Basics of command line use</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../example_scripts.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter_notebooks.html">Jupyter notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/parallelization.html">Parallel computing support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/user_basis.html"><cite>user_basis</cite> tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bugs &amp; Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute/report_a_bug.html">Report a bug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/ask_a_question.html">Ask a question</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QuSpin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Lanczos module: time-evolution and ground state search</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../sources/examples/example20.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style> .red {color:#ff0000; font-weight:bold; font-style:italic; } </style>
<style> .green {color:#00b200; font-weight:bold; font-style:italic; } </style>
<style> .magenta {color:#FF33F3; font-weight:bold; font-style:italic; } </style>
<style> .orange {color:#FE8E02; font-weight:bold; font-style:italic; } </style><section id="lanczos-module-time-evolution-and-ground-state-search">
<span id="example20-label"></span><h1>Lanczos module: time-evolution and ground state search<a class="headerlink" href="#lanczos-module-time-evolution-and-ground-state-search" title="Link to this heading"></a></h1>
<p>This example demonstrates how to use the <cite>Lanczos</cite> submodule of the <cite>tools</cite> module to do time evolvution and ground state search in the Heisenberg model:</p>
<div class="math notranslate nohighlight">
\[H = J\sum_{j=0}^{L-1} S^+_{j+1}S^-_{j} + \mathrm{h.c.} + S^z_{j+1}S^z_j,\]</div>
<p>where <span class="math notranslate nohighlight">\(S_j\)</span> is the spin-1/2 operator on lattice site <span class="math notranslate nohighlight">\(j\)</span>; we use periodic boundary conditions.</p>
<p>The Lanczos decomposition for the <span class="math notranslate nohighlight">\(n\times n\)</span> Hamiltonian matrix is defined as</p>
<div class="math notranslate nohighlight">
\[H \approx Q T Q^\dagger\]</div>
<p>for a real-valued, symmetric tridiagonal <span class="math notranslate nohighlight">\(m\times m\)</span> matrix <span class="math notranslate nohighlight">\(T=Q^\dagger HQ\)</span>, and (in general) a complex-valued <span class="math notranslate nohighlight">\(n\times m\)</span> matrix <span class="math notranslate nohighlight">\(Q\)</span> containing the orthonormal Lanczos vectors in the rows. Here <span class="math notranslate nohighlight">\(m\)</span> is the number of states kept in the Krylov subspace which controls the quality of the “Lanczos compression” of <span class="math notranslate nohighlight">\(H\)</span>. We further apply the eigenvalue decomposition <span class="math notranslate nohighlight">\(T=V \mathrm{diag}(E) V^T\)</span> and compute the eigenvectors <span class="math notranslate nohighlight">\(V\)</span> of <span class="math notranslate nohighlight">\(T\)</span> (note that this is computationally cheap for <span class="math notranslate nohighlight">\(m\ll n\)</span>).</p>
<section id="time-evolution">
<h2>Time evolution<a class="headerlink" href="#time-evolution" title="Link to this heading"></a></h2>
<p>With this information, we can compute an approximation to the matrix exponential, applied to a state <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> as follows:</p>
<div class="math notranslate nohighlight">
\[\exp(-i a H)|\psi\rangle \approx Q \exp(-i a T) Q^\dagger |\psi\rangle = Q V \mathrm{diag}(e^{-i a E}) V^T Q^\dagger |\psi\rangle.\]</div>
<p>If we use <span class="math notranslate nohighlight">\(|\psi\rangle\)</span> as the (nondegenerate) initial state for the Lanczos algorithm, then <span class="math notranslate nohighlight">\(\sum_{j,k}V^T_{ij}Q^\dagger_{jk}\psi_k = \sum_{j}V_{ji}\delta_{0,j} = V_{i,0}\)</span> [by construction, <span class="math notranslate nohighlight">\(\psi_k\)</span> is the zero-th row of <span class="math notranslate nohighlight">\(Q\)</span> and all the rows are orthonormal], and the expression simplifies further. Notice that these lines of thought apply to any matrix function, not just the matrix exponential.</p>
<p>The convergence of this method depends heavily on the function that is being approximated as well as the structure of the matrix. For the matrix exponential there is some literature in math/computer science that discuss error a-priori and a-posteriori bounds for krylow methods. The a-priori bounds are typically far from saturation when performing numerical experiments and the a-posteriori bounds are often impracticle to implement. One can easily check convergence by calculating the lanczos basis of size <cite>m</cite> but performing the calculation with <cite>m</cite> and <cite>m-1</cite> basis vectors and comparing the results, or by comparing the results of the lanczos calculation to some other method that is implemented, e.g. <cite>expm_multiply</cite> or <cite>expm_multiply_parallel</cite>.</p>
<p>In the case for <cite>expm_multiply_parallel</cite> the convergence is always guaranteed to be machine precision. The tolerance can be slightly controlled by switching between single and double precision floating point types which can often speed up the calculation by a factor of about 1.5. That being said, it is possible to get faster code; however, this requires more memory to store the lanczos vectors in memory during the calculation and often one has to experiment quite a bit to find the optimal time-step and number of lanczos vectors required to beat <cite>expm_multiply_parallel</cite>.</p>
</section>
<section id="ground-state-search">
<h2>Ground State Search<a class="headerlink" href="#ground-state-search" title="Link to this heading"></a></h2>
<p>One of the major uses of the Lanczos method is to find the ground state of a given matrix. It is important to remember that the Lanczos iteration projects out the eigenstates with the largest magnitude eigenvalues of the operator. As such, depending on which eigenvalues one is targeting one might have to transform the operator to make sure that the Lanczos algorithm targets that particular eigenvalue. In the case of the ground state, one either shift the operator by a constant as to make the magitude of the ground state the largest, however, in a lot of cases the ground state already has one of the largest magnitude eigenvalues.</p>
<p>After creating the lanczos basis, QuSpin will return the eigenvalues and vectors of the Krylov sub-space matrix <span class="math notranslate nohighlight">\(T\)</span>. If the operator has been transformed to create the Lanczos basis, one should perform the inverse transform of the eigenvalues to get the eigenvalues of the original operator. In the example below the ground state energy is the largest magnitude eigenvalue, hence we do not need to transform the Hamiltonian and likewise, the eigenvalues. The eigenvectors of the Hamiltonian can be constructed by taking linear combinations of the Lanczos basis with coefficients given by the eigenvectors of <span class="math notranslate nohighlight">\(T\)</span>.</p>
</section>
</section>
<section id="script">
<h1>Script<a class="headerlink" href="#script" title="Link to this heading"></a></h1>
<p><a class="reference download internal" download="" href="../downloads/4c50eee7ce639c83e9e8a09efbb01010/example20.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1">#</span>
<span class="linenos">  2</span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="linenos">  3</span>
<span class="linenos">  4</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;KMP_DUPLICATE_LIB_OK&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos">  5</span>    <span class="s2">&quot;True&quot;</span>  <span class="c1"># uncomment this line if omp error occurs on OSX for python 3</span>
<span class="linenos">  6</span><span class="p">)</span>
<span class="linenos">  7</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OMP_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>  <span class="c1"># set number of OpenMP threads to run in parallel</span>
<span class="linenos">  8</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MKL_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>  <span class="c1"># set number of MKL threads to run in parallel</span>
<span class="linenos">  9</span><span class="c1">#</span>
<span class="linenos"> 10</span>
<span class="linenos"> 11</span><span class="c1">#######################################################################</span>
<span class="linenos"> 12</span><span class="c1">#                            example 20                               #</span>
<span class="linenos"> 13</span><span class="c1"># This example shows how to use the `Lanczos` submodule of the        #</span>
<span class="linenos"> 14</span><span class="c1"># `tools` module to compute the time evolution of a quantum state     #</span>
<span class="linenos"> 15</span><span class="c1"># and how to find ground states of hermitian Hamiltonians.            #</span>
<span class="linenos"> 16</span><span class="c1">#######################################################################</span>
<span class="linenos"> 17</span><span class="kn">from</span> <span class="nn">quspin.basis</span> <span class="kn">import</span> <span class="n">spin_basis_1d</span>
<span class="linenos"> 18</span><span class="kn">from</span> <span class="nn">quspin.operators</span> <span class="kn">import</span> <span class="n">hamiltonian</span>
<span class="linenos"> 19</span><span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">expm_multiply</span>
<span class="linenos"> 20</span><span class="kn">from</span> <span class="nn">quspin.tools.lanczos</span> <span class="kn">import</span> <span class="n">lanczos_full</span><span class="p">,</span> <span class="n">lanczos_iter</span><span class="p">,</span> <span class="n">lin_comb_Q_T</span><span class="p">,</span> <span class="n">expm_lanczos</span>
<span class="linenos"> 21</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 22</span><span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">sla</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span><span class="c1">#</span>
<span class="linenos"> 25</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>  <span class="c1"># set random seed, cf initial state below</span>
<span class="linenos"> 26</span><span class="c1">#</span>
<span class="linenos"> 27</span><span class="c1">##### Heisenberg model</span>
<span class="linenos"> 28</span><span class="n">L</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># system size</span>
<span class="linenos"> 29</span><span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># unitary evolution time step</span>
<span class="linenos"> 30</span><span class="c1"># basis object</span>
<span class="linenos"> 31</span><span class="n">basis</span> <span class="o">=</span> <span class="n">spin_basis_1d</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">kblock</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">pblock</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zblock</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pauli</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 32</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Hilbert space dimension: </span><span class="si">{}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">basis</span><span class="o">.</span><span class="n">Ns</span><span class="p">))</span>
<span class="linenos"> 33</span><span class="c1"># Heisenberg Hamiltonian</span>
<span class="linenos"> 34</span><span class="n">J_list</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">L</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">)]</span>
<span class="linenos"> 35</span><span class="n">static</span> <span class="o">=</span> <span class="p">[[</span><span class="n">op</span><span class="p">,</span> <span class="n">J_list</span><span class="p">]</span> <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;xx&quot;</span><span class="p">,</span> <span class="s2">&quot;yy&quot;</span><span class="p">,</span> <span class="s2">&quot;zz&quot;</span><span class="p">]]</span>
<span class="linenos"> 36</span><span class="n">H</span> <span class="o">=</span> <span class="n">hamiltonian</span><span class="p">(</span><span class="n">static</span><span class="p">,</span> <span class="p">[],</span> <span class="n">basis</span><span class="o">=</span><span class="n">basis</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="linenos"> 37</span><span class="c1">#</span>
<span class="linenos"> 38</span><span class="c1">##### Lanczos time evolution calculation</span>
<span class="linenos"> 39</span><span class="c1">#</span>
<span class="linenos"> 40</span><span class="n">m_evo</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Krylov subspace dimension</span>
<span class="linenos"> 41</span><span class="c1">#</span>
<span class="linenos"> 42</span><span class="c1"># initial states</span>
<span class="linenos"> 43</span><span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">basis</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>
<span class="linenos"> 44</span><span class="n">v0</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
<span class="linenos"> 45</span><span class="c1"># make copies to test the lanczos routines independently</span>
<span class="linenos"> 46</span><span class="n">v_expm_multiply</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 47</span><span class="n">v_lanczos_full</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 48</span><span class="n">v_lanczos_iter</span> <span class="o">=</span> <span class="n">v0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos"> 49</span><span class="c1">#</span>
<span class="linenos"> 50</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">checking lanczos matrix exponential calculation:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 51</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
<span class="linenos"> 52</span>    <span class="c1"># compute Lanczos decomposition</span>
<span class="linenos"> 53</span>    <span class="n">E_full</span><span class="p">,</span> <span class="n">V_full</span><span class="p">,</span> <span class="n">Q_full</span> <span class="o">=</span> <span class="n">lanczos_full</span><span class="p">(</span>
<span class="linenos"> 54</span>        <span class="n">H</span><span class="p">,</span> <span class="n">v_lanczos_full</span><span class="p">,</span> <span class="n">m_evo</span>
<span class="linenos"> 55</span>    <span class="p">)</span>  <span class="c1"># all Lanczos vectors at once</span>
<span class="linenos"> 56</span>    <span class="n">E_iter</span><span class="p">,</span> <span class="n">V_iter</span><span class="p">,</span> <span class="n">Q_iter</span> <span class="o">=</span> <span class="n">lanczos_iter</span><span class="p">(</span>
<span class="linenos"> 57</span>        <span class="n">H</span><span class="p">,</span> <span class="n">v_lanczos_iter</span><span class="p">,</span> <span class="n">m_evo</span>
<span class="linenos"> 58</span>    <span class="p">)</span>  <span class="c1"># Lanczos vectors as an iterator</span>
<span class="linenos"> 59</span>    <span class="c1"># evolve quantum state using different routines</span>
<span class="linenos"> 60</span>    <span class="n">v_expm_multiply</span> <span class="o">=</span> <span class="n">expm_multiply</span><span class="p">(</span>
<span class="linenos"> 61</span>        <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">H</span><span class="o">.</span><span class="n">static</span><span class="p">,</span> <span class="n">v_expm_multiply</span>
<span class="linenos"> 62</span>    <span class="p">)</span>  <span class="c1"># cf tools.expm_multiply_parallel with OMP speedup</span>
<span class="linenos"> 63</span>    <span class="n">v_lanczos_full</span> <span class="o">=</span> <span class="n">expm_lanczos</span><span class="p">(</span><span class="n">E_full</span><span class="p">,</span> <span class="n">V_full</span><span class="p">,</span> <span class="n">Q_full</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
<span class="linenos"> 64</span>    <span class="n">v_lanczos_iter</span> <span class="o">=</span> <span class="n">expm_lanczos</span><span class="p">(</span><span class="n">E_iter</span><span class="p">,</span> <span class="n">V_iter</span><span class="p">,</span> <span class="n">Q_iter</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
<span class="linenos"> 65</span>    <span class="c1"># test results against each other</span>
<span class="linenos"> 66</span>    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">v_lanczos_full</span><span class="p">,</span> <span class="n">v_expm_multiply</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 67</span>    <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">v_lanczos_iter</span><span class="p">,</span> <span class="n">v_expm_multiply</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 68</span>    <span class="c1">#</span>
<span class="linenos"> 69</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finished unitary evolution step: </span><span class="si">{0:d}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="linenos"> 70</span><span class="c1">#</span>
<span class="linenos"> 71</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">time evolution complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos"> 72</span><span class="c1">#</span>
<span class="linenos"> 73</span><span class="c1">###### Lanczos ground state calculation</span>
<span class="linenos"> 74</span><span class="c1">#</span>
<span class="linenos"> 75</span><span class="c1"># compute exact GS data</span>
<span class="linenos"> 76</span><span class="n">E_GS</span><span class="p">,</span> <span class="n">psi_GS</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;SA&quot;</span><span class="p">)</span>
<span class="linenos"> 77</span><span class="n">psi_GS</span> <span class="o">=</span> <span class="n">psi_GS</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="linenos"> 78</span><span class="c1">#</span>
<span class="linenos"> 79</span><span class="c1">###### apply Lanczos</span>
<span class="linenos"> 80</span><span class="c1"># initial state for Lanczos algorithm</span>
<span class="linenos"> 81</span><span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">basis</span><span class="o">.</span><span class="n">Ns</span><span class="p">)</span>
<span class="linenos"> 82</span><span class="n">v0</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
<span class="linenos"> 83</span><span class="c1">#</span>
<span class="linenos"> 84</span><span class="n">m_GS</span> <span class="o">=</span> <span class="mi">50</span>  <span class="c1"># Krylov subspace dimension</span>
<span class="linenos"> 85</span><span class="c1">#</span>
<span class="linenos"> 86</span><span class="c1"># Lanczos finds the largest-magnitude eigenvalues:</span>
<span class="linenos"> 87</span><span class="n">E</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q_T</span> <span class="o">=</span> <span class="n">lanczos_full</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">m_GS</span><span class="p">,</span> <span class="n">full_ortho</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos"> 88</span><span class="c1">#</span>
<span class="linenos"> 89</span><span class="c1"># check GS energy convergence</span>
<span class="linenos"> 90</span><span class="k">try</span><span class="p">:</span>
<span class="linenos"> 91</span>    <span class="c1"># compute difference to exact GS energy value</span>
<span class="linenos"> 92</span>    <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">E_GS</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="linenos"> 93</span>    <span class="k">assert</span> <span class="n">dE</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>
<span class="linenos"> 94</span><span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
<span class="linenos"> 95</span>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
<span class="linenos"> 96</span>        <span class="s2">&quot;Energy failed to converge |E_lanczos-E_exact| = </span><span class="si">{}</span><span class="s2"> &gt; 1e-10&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dE</span><span class="p">)</span>
<span class="linenos"> 97</span>    <span class="p">)</span>
<span class="linenos"> 98</span><span class="c1">#</span>
<span class="linenos"> 99</span><span class="c1"># compute ground state vector</span>
<span class="linenos">100</span><span class="n">psi_GS_lanczos</span> <span class="o">=</span> <span class="n">lin_comb_Q_T</span><span class="p">(</span><span class="n">V</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">Q_T</span><span class="p">)</span>
<span class="linenos">101</span><span class="c1"># check ground state convergence</span>
<span class="linenos">102</span><span class="k">try</span><span class="p">:</span>
<span class="linenos">103</span>    <span class="c1"># compute fidelity of being in exact GS</span>
<span class="linenos">104</span>    <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">psi_GS_lanczos</span><span class="p">,</span> <span class="n">psi_GS</span><span class="p">))))</span>
<span class="linenos">105</span>    <span class="k">assert</span> <span class="n">F</span> <span class="o">&lt;</span> <span class="mf">1e-10</span>
<span class="linenos">106</span><span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
<span class="linenos">107</span>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
<span class="linenos">108</span>        <span class="s2">&quot;wavefunction failed to converge to fidelity = </span><span class="si">{}</span><span class="s2"> &gt; 1e-10&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="p">)</span>
<span class="linenos">110</span><span class="c1">#</span>
<span class="linenos">111</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ground state calculation complete.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Phillip Weinberg, Markus Schmitt, and Marin Bukov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6885KZ7NH6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6885KZ7NH6', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>