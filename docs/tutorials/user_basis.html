<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>user_basis tutorial &mdash; QuSpin 1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../static/css/sphinx_rtd_size.css?v=f26ae176" />
      <link rel="stylesheet" type="text/css" href="../static/css/py_class_property_fix.css?v=faf79ccd" />

  
  <!--[if lt IE 9]>
    <script src="../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../static/jquery.js?v=5d32c60e"></script>
        <script src="../static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../static/documentation_options.js?v=292eb321"></script>
        <script src="../static/doctools.js?v=9a2dae69"></script>
        <script src="../static/sphinx_highlight.js?v=dc90522c"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Report a bug" href="../contribute/report_a_bug.html" />
    <link rel="prev" title="Parallel computing support" href="parallelization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            QuSpin
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">New Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../new_features.html">Highlights</a></li>
<li class="toctree-l1"><a class="reference internal" href="../new_features.html#most-recent-changes-features">Most recent changes &amp; features</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">QuSpin (public API)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basis.html">Basis module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.basis</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../operators.html">Operators module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.operators</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">Tools module (<code class="xref py py-mod docutils literal notranslate"><span class="pre">quspin.tools</span></code>)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation &amp; Use</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html#basics-of-command-line-use">Basics of command line use</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../example_scripts.html">Example scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jupyter_notebooks.html">Jupyter notebooks</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="parallelization.html">Parallel computing support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><cite>user_basis</cite> tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#integer-representation-of-states">Integer representation of states</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spin-1-2-fermions-hardcore-bosons">Spin-1/2, Fermions, Hardcore Bosons</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#definition">Definition:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-off-particle-occupation-on-a-given-site">Reading off particle occupation on a given site:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flipping-particle-occupation-on-a-given-site">Flipping particle occupation on a given site:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#local-hilbert-space-dimension-larger-than-two-bosons-higher-spins-etc">Local Hilbert space dimension larger than two: bosons, higher spins, etc.</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">Definition:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">Reading off particle occupation on a given site:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#increasing-the-particle-occupation-on-a-given-site">Increasing the particle occupation on a given site:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decreasing-the-particle-occupation-on-a-given-site">Decreasing the particle occupation on a given site:</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#notes"><em>Notes</em>:</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#user-basis-function-methods"><cite>user_basis</cite> function methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#op-op-struct-ptr-op-str-site-ind-n-args"><cite>op(op_struct_ptr, op_str, site_ind, N, args)</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#next-state-s-counter-n-args"><cite>next_state(s, counter, N, args)</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#pre-check-state-s-n-args"><cite>pre_check_state(s, N, args)</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#count-particles-s-p-number-ptr-args"><cite>count_particles(s, p_number_ptr, args)</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#symmetry-transformations-from-bit-operations">Symmetry transformations from bit operations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#symmetry-map-s-n-sign-ptr-args"><cite>symmetry_map(s, N, sign_ptr, args)</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-size-independent-symmetries">System-size independent symmetries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parity-in-1d-for-any-system-size-n">parity in 1d for any system size <cite>N</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#translation-in-1d-for-any-system-size-n">translation in 1d for any system size <cite>N</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#symmetries-for-fixed-system-sizes-using-precomputed-masks">Symmetries for fixed system sizes using precomputed masks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parity-in-1d-for-a-fixed-system-size-n-10">parity in 1d for a fixed system size <cite>N=10</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="#translation-in-1d-for-a-fixed-system-size-n-10">translation in 1d for a fixed system size <cite>N=10</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#symmetry-maps-dictionary">Symmetry <cite>maps</cite> dictionary</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-numba-to-pass-python-functions-to-the-c-user-basis-constructor">Using <cite>numba</cite> to pass python functions to the C++ <cite>user_basis</cite> constructor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-types">Data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#function-decorators">Function decorators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example-scripts">Example Scripts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#scripts-to-construct-spin-fermion-and-boson-bases">Scripts to construct spin, fermion, and boson bases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scripts-to-demonstrate-the-additional-functionality-introduced-by-the-user-basis">Scripts to demonstrate the additional functionality introduced by the <cite>user_basis</cite></a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bugs &amp; Questions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contribute/report_a_bug.html">Report a bug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/ask_a_question.html">Ask a question</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">QuSpin</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><cite>user_basis</cite> tutorial</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../sources/tutorials/user_basis.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <style> .red {color:#ff0000; font-weight:bold; font-style:italic; } </style>
<style> .green {color:#00b200; font-weight:bold; font-style:italic; } </style>
<style> .magenta {color:#FF33F3; font-weight:bold; font-style:italic; } </style>
<style> .orange {color:#FE8E02; font-weight:bold; font-style:italic; } </style><section id="user-basis-tutorial">
<span id="user-basis-label"></span><h1><cite>user_basis</cite> tutorial<a class="headerlink" href="#user-basis-tutorial" title="Link to this heading"></a></h1>
<p>List of functionality features which <cite>user_basis</cite> allows the user to access, and which are <strong>not</strong> accessible in the <cite>*_basis_1d</cite> and <cite>*_basis_general</cite>:</p>
<ul class="simple">
<li><p>Constrained Hilbert Spaces</p></li>
<li><p>Quantum Clock and Potts models</p></li>
<li><p>Implement symmetries which act on the local Hilbert space, e.g. <span class="math notranslate nohighlight">\(\mathbb{Z}_n, n&gt;2\)</span></p></li>
<li><p>Symmetries for mixed particle representations, e.g. Bose-Fermi or spin-fermion mixtures.</p></li>
<li><p>Optimized low-level functions increasing performence in constructing operators.</p></li>
<li><p>Construct a basis through some other means but use it within QuSpin (e.g. to further reduce it by applying symmetries).</p></li>
</ul>
<p>The <cite>user_basis</cite> class brings to surface the low-level functionality of the <cite>basis_general</cite> core class and allows the user to customize the corresponding function methods, thereby creating their provate QuSpin basis class.</p>
<p><strong>TUTORIAL CONTENTS:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt><a class="reference internal" href="#integer-representation-of-states">Integer representation of states</a></dt><dd><ul>
<li><p><a class="reference internal" href="#spin-1-2-fermions-hardcore-bosons">Spin-1/2, Fermions, Hardcore Bosons</a></p></li>
<li><p><a class="reference internal" href="#local-hilbert-space-dimension-larger-than-two-bosons-higher-spins-etc">Local Hilbert space dimension larger than two: bosons, higher spins, etc.</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#user-basis-function-methods">user_basis function methods</a></dt><dd><ul>
<li><p><a class="reference internal" href="#op-op-struct-ptr-op-str-site-ind-n-args">op(op_struct_ptr, op_str, site_ind, N, args)</a></p></li>
<li><p><a class="reference internal" href="#next-state-s-counter-n-args">next_state(s, counter, N, args)</a></p></li>
<li><p><a class="reference internal" href="#pre-check-state-s-n-args">pre_check_state(s, N, args)</a></p></li>
<li><p><a class="reference internal" href="#count-particles-s-p-number-ptr-args">count_particles(s, p_number_ptr, args)</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#symmetry-transformations-from-bit-operations">Symmetry transformations from bit operations</a></dt><dd><ul>
<li><p><a class="reference internal" href="#symmetry-map-s-n-sign-ptr-args">symmetry_map(s, N, sign_ptr, args)</a></p></li>
<li><p><a class="reference internal" href="#system-size-independent-symmetries">System-size independent symmetries</a></p></li>
<li><p><a class="reference internal" href="#symmetries-for-fixed-system-sizes-using-precomputed-masks">Symmetries for fixed system sizes using precomputed masks</a></p></li>
<li><p><a class="reference internal" href="#symmetry-maps-dictionary">Symmetry maps dictionary</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#using-numba-to-pass-python-functions-to-the-c-user-basis-constructor">Using numba to pass python functions to the C++ user_basis constructor</a></dt><dd><ul>
<li><p><a class="reference internal" href="#data-types">Data types</a></p></li>
<li><p><a class="reference internal" href="#function-decorators">Function decorators</a></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><a class="reference internal" href="#example-scripts">Example Scripts</a></dt><dd><ul>
<li><p><a class="reference internal" href="#scripts-to-construct-spin-fermion-and-boson-bases">Scripts to construct spin, fermion, and boson bases</a></p></li>
<li><p><a class="reference internal" href="#scripts-to-demonstrate-the-additional-functionality-introduced-by-the-user-basis">Scripts to demonstrate the additional functionality introduced by the user_basis</a></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<section id="integer-representation-of-states">
<h2>Integer representation of states<a class="headerlink" href="#integer-representation-of-states" title="Link to this heading"></a></h2>
<p>The computational basis in QuSpin is the on-site particle/spin-z basis. For computational efficiency, basis states are stored as bit representations of integers. In order to fully grasp the underlying ideas behind the <cite>user_basis</cite> functionality, it is required to explain in detail how this works.</p>
<section id="spin-1-2-fermions-hardcore-bosons">
<h3>Spin-1/2, Fermions, Hardcore Bosons<a class="headerlink" href="#spin-1-2-fermions-hardcore-bosons" title="Link to this heading"></a></h3>
<p>Spin-<span class="math notranslate nohighlight">\(1/2\)</span>, hardcore-boson, and fermion states all have in common that they allow at most one particle pre site. Thus, in the particle/z-spin basis, the basis states are given by strings of ones and zeros. The number of ones sets the particle number/magnetization of a given state.</p>
<p>Coincidentally, integers are stored in memory using the so-called binary representation: every integer is assigned a unique bit string. Therefore, a particularly efficient way of storing basis states is via this integer representation.</p>
<p><strong>CONVENTION</strong>: in QuSpin, the integer corresponding to a given spin configuration is given by the integer representation of the Fock state bitstring. The lattice indices are defined in <strong>reversed</strong> order. For instance in a chain of four sites, we have:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|0000\rangle \leftrightarrow 0\)</span>:    empty lattice,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0001\rangle \leftrightarrow 1\)</span>:    one particle at site 3,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0010\rangle \leftrightarrow 2\)</span>:    one particle at site 2,</p></li>
<li><p><span class="math notranslate nohighlight">\(|1000\rangle \leftrightarrow 8\)</span>:    one particle at site 0,</p></li>
</ul>
<p>In short, the bitstring is the same as the quantum state; the lattice site label is reversed relative to the bitstring (i.e. from left to right starting with 0).</p>
<p><em>Note</em>: the <cite>user_basis</cite> allows the user to adopt their own convention. For consistency, this tutorial follows the above QuSpin convention.</p>
<section id="definition">
<h4>Definition:<a class="headerlink" href="#definition" title="Link to this heading"></a></h4>
<p>Cosider an <span class="math notranslate nohighlight">\(N\)</span>-site lattice. Let <span class="math notranslate nohighlight">\(c_i\)</span> denote the occupation of site <span class="math notranslate nohighlight">\(i \in [0,1,\dots,N-1]\)</span> (e.g., for <span class="math notranslate nohighlight">\(|0100\rangle\)</span> we have <span class="math notranslate nohighlight">\(c_1=1\)</span> and <span class="math notranslate nohighlight">\(c_{i\neq 1}=0\)</span>). Then, a generic expression for the integer <span class="math notranslate nohighlight">\(s\)</span>, corresponding to the state <span class="math notranslate nohighlight">\(|\{c_i\}\rangle\)</span>, is given by</p>
<div class="math notranslate nohighlight">
\[s = \sum_{j=0}^{N-1} c_j 2^{N-1-j}\]</div>
</section>
<section id="reading-off-particle-occupation-on-a-given-site">
<h4>Reading off particle occupation on a given site:<a class="headerlink" href="#reading-off-particle-occupation-on-a-given-site" title="Link to this heading"></a></h4>
<p>To read off the particle occupation on site <span class="math notranslate nohighlight">\(j\)</span> of the state <span class="math notranslate nohighlight">\(s\)</span> (with a total of <span class="math notranslate nohighlight">\(N\)</span> sites), do</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>     <span class="c1"># compute lattice site in reversed bit configuration (cf QuSpin convention for mapping from bits to sites)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">&gt;&gt;</span><span class="n">j</span><span class="p">)</span><span class="o">&amp;</span><span class="mi">1</span>    <span class="c1"># occupation: either 0 or 1</span>
</pre></div>
</div>
</section>
<section id="flipping-particle-occupation-on-a-given-site">
<h4>Flipping particle occupation on a given site:<a class="headerlink" href="#flipping-particle-occupation-on-a-given-site" title="Link to this heading"></a></h4>
<p>To flip the particle occupation on site <span class="math notranslate nohighlight">\(j\)</span> of the state <span class="math notranslate nohighlight">\(s\)</span> (with a total of <span class="math notranslate nohighlight">\(N\)</span> sites), use the XOR operator <cite>^</cite> :</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>     <span class="c1"># compute lattice site in reversed bit configuration (cf QuSpin convention for mapping from bits to sites)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">b</span> <span class="o">&lt;&lt;=</span> <span class="n">j</span>    <span class="c1"># compute a &quot;mask&quot; integer b which is 1 on site j and zero elsewhere</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">^=</span> <span class="n">b</span>            <span class="c1"># flip occupation on site j</span>
</pre></div>
</div>
</section>
</section>
<section id="local-hilbert-space-dimension-larger-than-two-bosons-higher-spins-etc">
<h3>Local Hilbert space dimension larger than two: bosons, higher spins, etc.<a class="headerlink" href="#local-hilbert-space-dimension-larger-than-two-bosons-higher-spins-etc" title="Link to this heading"></a></h3>
<p>When dealing with bosons or higher spins, the binary representation is no longer convenient, since the local on-site occupation can be larger than one.</p>
<section id="id1">
<h4>Definition:<a class="headerlink" href="#id1" title="Link to this heading"></a></h4>
<p>Denoting by <span class="math notranslate nohighlight">\(sps\)</span> (states per site) the local on-site Hilbert space dimension, the integer compression of basis states generalizes to:</p>
<div class="math notranslate nohighlight">
\[s = \sum_{j=0}^{N-1} c_j sps^{N-1-j}\]</div>
<p>For instance in a chain of four sites with at most two particles per site (i.e., three states: <span class="math notranslate nohighlight">\(sps=3\)</span>), we have:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|0000\rangle \leftrightarrow 0\)</span>:    empty lattice,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0001\rangle \leftrightarrow 1\)</span>:    one particle at site 3,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0010\rangle \leftrightarrow 3\)</span>:    one particle at site 2,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0020\rangle \leftrightarrow 6\)</span>:    two particles at site 2,</p></li>
<li><p><span class="math notranslate nohighlight">\(|0210\rangle \leftrightarrow 21\)</span>:    one particle at site 2 and two particles at site 1,</p></li>
<li><p><span class="math notranslate nohighlight">\(|1000\rangle \leftrightarrow 27\)</span>:    one particle at site 0,</p></li>
</ul>
<p><em>Note</em>: In some cases when <span class="math notranslate nohighlight">\(sps=2^n\)</span> one can partition the integer bits into sections of size <cite>n</cite> and still use binary operations. In this case the code will most likely be faster, however it becomes more complicated to write the bit operations. The user can still use the value <cite>sps</cite> for a given model when passing arguments into the <cite>user_basis</cite> class, as this will not affect the underlying numba code implementation (see below).</p>
</section>
<section id="id2">
<h4>Reading off particle occupation on a given site:<a class="headerlink" href="#id2" title="Link to this heading"></a></h4>
<p>To read off the particle occupation on site <span class="math notranslate nohighlight">\(j\)</span> of the state <span class="math notranslate nohighlight">\(s\)</span> (with a total of <span class="math notranslate nohighlight">\(N\)</span> sites and <span class="math notranslate nohighlight">\(sps\)</span> states per site), do</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>            <span class="c1"># compute lattice site in reversed bit configuration (cf QuSpin convention for mapping from bits to sites)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">//</span><span class="p">(</span><span class="n">sps</span><span class="o">**</span><span class="n">j</span><span class="p">))</span><span class="o">%</span><span class="n">sps</span>  <span class="c1"># occupation: can be 0, 1, ..., sps-1</span>
</pre></div>
</div>
</section>
<section id="increasing-the-particle-occupation-on-a-given-site">
<h4>Increasing the particle occupation on a given site:<a class="headerlink" href="#increasing-the-particle-occupation-on-a-given-site" title="Link to this heading"></a></h4>
<p>To increase the particle occupation on site <span class="math notranslate nohighlight">\(j\)</span> of the state <span class="math notranslate nohighlight">\(s\)</span> (with a total of <span class="math notranslate nohighlight">\(N\)</span> sites and <span class="math notranslate nohighlight">\(sps\)</span> states per site), do</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>            <span class="c1"># compute lattice site in reversed bit configuration (cf QuSpin convention for mapping from bits to sites)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">sps</span><span class="o">**</span><span class="n">j</span>               <span class="c1"># obtain mask integer b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">//</span><span class="n">b</span><span class="p">))</span><span class="o">%</span><span class="n">sps</span>        <span class="c1"># compute occupation on site j</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="p">(</span><span class="n">occ</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">sps</span><span class="p">):</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">b</span>   <span class="c1"># increase occupation on site j by one</span>
</pre></div>
</div>
</section>
<section id="decreasing-the-particle-occupation-on-a-given-site">
<h4>Decreasing the particle occupation on a given site:<a class="headerlink" href="#decreasing-the-particle-occupation-on-a-given-site" title="Link to this heading"></a></h4>
<p>To decrease the particle occupation on site <span class="math notranslate nohighlight">\(j\)</span> of the state <span class="math notranslate nohighlight">\(s\)</span> (with a total of <span class="math notranslate nohighlight">\(N\)</span> sites and <span class="math notranslate nohighlight">\(sps\)</span> states per site), do</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span>            <span class="c1"># compute lattice site in reversed bit configuration (cf QuSpin convention for mapping from bits to sites)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">sps</span><span class="o">**</span><span class="n">j</span>               <span class="c1"># obtain mask integer b</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">occ</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">//</span><span class="n">b</span><span class="p">)</span><span class="o">%</span><span class="n">sps</span>         <span class="c1"># compute occupation on site j</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="p">(</span><span class="n">occ</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">):</span> <span class="n">r</span> <span class="o">-=</span> <span class="n">b</span>       <span class="c1"># decrease occupation on site j by one</span>
</pre></div>
</div>
</section>
</section>
<section id="notes">
<h3><em>Notes</em>:<a class="headerlink" href="#notes" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>even though in the case <span class="math notranslate nohighlight">\(sps=2\)</span>, the above expressions reproduce the corresponding spin-1/2 expressions, they are not as efficient computationally.</p></li>
<li><p>convenient quspin functions to transform between integer and quspin bit representations are <cite>basis.int_to_state()</cite> and <cite>basis.state_to_int()</cite>.</p></li>
<li><p>the attribute <cite>basis.states</cite> holds all states of the basis in their integer representation. The function <cite>basis.index()</cite> returns the position of a given state in the basis (useful for computing specific matrix elements or for defining states).</p></li>
<li><p>printing a basis object <cite>print(basis)</cite> displays the states in their quantum mechanical notation, together with the order in which they appear in the basis, and the integer representation.</p></li>
</ul>
</section>
</section>
<section id="user-basis-function-methods">
<h2><cite>user_basis</cite> function methods<a class="headerlink" href="#user-basis-function-methods" title="Link to this heading"></a></h2>
<p>The core parent class for all <cite>basis_general</cite> classes contains a number of function methods to facilitate the construction of the basis and the basis methods. The <cite>user_basis</cite> exposes those methods which can be re-defined/overridden by the user. This enhances the functionality of QuSpin, allowing the user maximum flexibility in constructing basis objects.</p>
<p>Below, we give a brief overview of the methods required to define <cite>user_basis</cite> objects.</p>
<section id="op-op-struct-ptr-op-str-site-ind-n-args">
<h3><cite>op(op_struct_ptr, op_str, site_ind, N, args)</cite><a class="headerlink" href="#op-op-struct-ptr-op-str-site-ind-n-args" title="Link to this heading"></a></h3>
<p>This function method contains user-defined action of operators <span class="math notranslate nohighlight">\(O\)</span> on the integer states <span class="math notranslate nohighlight">\(|s\rangle\)</span> which produces the matrix elements <span class="math notranslate nohighlight">\(\mathrm{me}\)</span> via <span class="math notranslate nohighlight">\(O|s\rangle = \mathrm{me}|s'\rangle\)</span>.</p>
<ul class="simple">
<li><p><cite>op_struct_ptr</cite>: a C++ pointer to an object which, after being cast into an array using <cite>op_struct=carray(op_struct_ptr,1)[0]</cite>, contains the attributes <cite>op_struct.state</cite> (which contains the quantum state in integer representation), and <cite>op_struct.matrix_ele</cite> (the value of the corresponding matrix element which defines the action of the operator <span class="math notranslate nohighlight">\(O\)</span>.).</p></li>
<li><p><cite>op_str</cite>: holds the operator string (e.g. <cite>+</cite>, <cite>-</cite>, <cite>z</cite>, <cite>n</cite>, or any custom user-defined letter). Due to limitations in compiling python functions (see section on <cite>numba</cite> below), the charactors are passed in as integers using utf-8 unicode, e.g. <cite>+</cite> corresponds to the integer <cite>43</cite>. Because of this one has to compare <cite>op_str</cite> to an integer representing the character of your choice in the body of <cite>op()</cite>. The integer, corresponding to any character <cite>str</cite> can be found in python using <cite>ord(str)</cite> or by looking up a utf-8 unicode table.</p></li>
<li><p><cite>N</cite>: the total number of lattice sites.</p></li>
<li><p><cite>args</cite>: optional arguments passed into the CFunc <cite>op</cite>; must be a <cite>np.ndarray</cite> of dtype <cite>basis_dtype</cite>.</p></li>
</ul>
<p>The CFunc <cite>op</cite> returns an integer <cite>err</cite> which is used by QuSpin to throw different error messages. The following are reserved by QuSpin:</p>
<ul class="simple">
<li><p><cite>err=0</cite>: the calculation was completed successfully.</p></li>
<li><p><cite>err=-1</cite>: no matching operator string was found.</p></li>
<li><p><cite>err=1</cite>: using real dtype for complex value.</p></li>
</ul>
<p>If the error code returned is not one of these values QuSpin will raise a <cite>RunTimeError</cite> with the message: “user defined error code: &lt;err&gt;”, with &lt;err&gt; being the integer value returned by the user defined op CFunc. In this way the user can provide custom errors.</p>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>this functionality will not support branching, i.e. no linear combination of multiple states in the basis, e.g. <span class="math notranslate nohighlight">\(O|s\rangle = \mathrm{me}_1|s'_1\rangle + \mathrm{me}_2|s'_2\rangle + \dots\)</span>, is NOT allowed.</p></li>
</ul>
</section>
<section id="next-state-s-counter-n-args">
<h3><cite>next_state(s, counter, N, args)</cite><a class="headerlink" href="#next-state-s-counter-n-args" title="Link to this heading"></a></h3>
<p>This function method provides a user-defined particle conservation rule, which constructs the basis in ascending order by numerical value. Given the initial state <cite>s0</cite>, <cite>next_state()</cite> generates all other states successively. Hence, if <cite>next_state()</cite> is set to conserve particle number then the particle number sector is defined by the initial state <cite>s0</cite>.</p>
<ul class="simple">
<li><p><cite>s</cite>: quantum state in integer representation.</p></li>
<li><p><cite>counter</cite>: an integer which counts internally how many times the function has been called. The incrementation of <cite>counter</cite> will occur in the underlying C++ code, i.e. the user should not attempt to do this in the function body of <cite>next_state()</cite>. Can be used, e.g., to index an array passed in <cite>args</cite>, cf. <a class="reference internal" href="../examples/example16.html#example16-label"><span class="std std-ref">Applying symmetries to reduce user-imported bases using QuSpin</span></a>.</p></li>
<li><p><cite>args</cite>: a <cite>np.ndarray</cite> of the same data type as the <cite>user_basis</cite>. Can be used to pass optional arguments, e.g. to pass a precomputed basis into QuSpin in order to reduce it to a given symmetry sector: cf. <a class="reference internal" href="../examples/example16.html#example16-label"><span class="std std-ref">Applying symmetries to reduce user-imported bases using QuSpin</span></a>.</p></li>
</ul>
<p><strong>Two extra python functions required</strong>: they are <strong>not</strong> called inside <cite>next_state()</cite>, but are required by QuSpin to run <cite>next_state()</cite>.</p>
<ul class="simple">
<li><p>get_s0_pcon(N,Np): given the total number of sites <cite>N</cite> and (the tuple of) particle sector <cite>Np</cite> this function computes the initial state, to be used by <cite>next_state()</cite> to construct the entire basis.</p></li>
<li><p>get_Ns_pcon(N,Np): given the total number of sites <cite>N</cite> and (the tuple of) particle sector <cite>Np</cite> this function computes the Hilbert space dimension (i.e. the size of the basis) <strong>with particle number conservation only</strong> (in other words, <cite>get_Ns_pcon()</cite> should be equal to the number of iterations in <cite>next_state()</cite> required to exhaust the states search). <cite>get_Ns_pcon()</cite> returns an integer required to allocate memory for the particle-conserving basis. Note that <cite>get_Ns_pcon()</cite> ignores any possible reduction due to lattice symmetries (implemened via maps, see below), i.e. <cite>get_Ns_pcon()</cite> may not correspond to the final integer <cite>basis.Ns</cite>.</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>there is no need to define <cite>next_state()</cite> if no particle number conservation use is intended, cf. <a class="reference internal" href="../examples/example14.html#example14-label"><span class="std std-ref">Quantum scars Hamiltonian: spin-1/2 system with Hilbert space constraint</span></a>.</p></li>
<li><p>one can use this function, e.g., to implement sublattice particle number conservation, and similar features.</p></li>
<li><p><cite>next_state()</cite>, together with the entire set of related functions and variables is passed to the <cite>user_basis</cite> constructor via the <cite>pcon_dict</cite> dictionary.</p></li>
<li><p><cite>next_state()</cite> is a numba.CFunc object, but <cite>get_s0_pcon()</cite> and <cite>get_Ns_pcon()</cite> are regular python functions.</p></li>
</ul>
</section>
<section id="pre-check-state-s-n-args">
<h3><cite>pre_check_state(s, N, args)</cite><a class="headerlink" href="#pre-check-state-s-n-args" title="Link to this heading"></a></h3>
<p>This <em>optional</em> function method provides user-defined extra filtering of basis states. The function body contains a boolean operation which, when applied to the basis states one at a time, determines whether to keep a state in the basis or not. This is independent of the lattice symmetries (implemented via maps, see below), and can be interpreted as a projection or a constraint on the Hilbert space.</p>
<p>A simple example of what <cite>pre_check_state()</cite> can be useful for is this: suppose you want a <cite>spinful_fermion_basis()</cite> without doubly occupied sites. This can be achieved by ajusting the body of <cite>pre_check_state()</cite> to eliminate such states. QuSpin will then first generate the basis with doble occupancies using <cite>next_state()</cite>, and subsequntly get rid of the doubly-occupied states using <cite>pre_check_state()</cite>. Another example is shown in <a class="reference internal" href="../examples/example14.html#example14-label"><span class="std std-ref">Quantum scars Hamiltonian: spin-1/2 system with Hilbert space constraint</span></a>.</p>
<ul class="simple">
<li><p><cite>s</cite>: quantum state in integer representation.</p></li>
<li><p><cite>N</cite>: the total number of lattice sites.</p></li>
<li><p><cite>args</cite>: a <cite>np.ndarray</cite> of the same data type as the <cite>user_basis</cite>. Can be used to pass optional arguments.</p></li>
</ul>
</section>
<section id="count-particles-s-p-number-ptr-args">
<h3><cite>count_particles(s, p_number_ptr, args)</cite><a class="headerlink" href="#count-particles-s-p-number-ptr-args" title="Link to this heading"></a></h3>
<p>This <em>optional</em> function method counts the total number of particles/magnetization in a given state.</p>
<ul class="simple">
<li><p><cite>s</cite>: quantum state in integer representation.</p></li>
<li><p><cite>p_number_ptr</cite>: pointer of length <cite>n_sectors</cite> to fill in the number of particles. Each entry should correspond to the given particle sector in <cite>Np</cite>.</p></li>
<li><p><cite>args</cite>: a <cite>np.ndarray</cite> of data type <cite>np.integer</cite>. Can be used to pass optional arguments.</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>this function does <strong>not</strong> return anything. Fill in the pointer <cite>p_number_ptr</cite> with the output instead.</p></li>
<li><p>make sure that <cite>p_number_ptr[i]</cite> corresponds to the particle sector <cite>Np[i]</cite>, etc.</p></li>
</ul>
</section>
</section>
<section id="symmetry-transformations-from-bit-operations">
<h2>Symmetry transformations from bit operations<a class="headerlink" href="#symmetry-transformations-from-bit-operations" title="Link to this heading"></a></h2>
<p>Any discrete symmetry is uniquely defined by its action on the basis states. Since the basis is stored in the integer representation, the symmetry operations have to be defined to transform integers. In the <cite>basis_1d</cite> and <cite>basis_general</cite> classes this is done under the hood; the <cite>user_basis</cite> brings this functionality to the surface, and allows the user to modify it accordingly.</p>
<p><em>Note</em>: these functions can be used to generate symmetries of the local Hilbert space. E.g., in the Quantum Clock model the interactions are rotationally invariant with respect to the local states and therefore one can perform a global clock rotation on all states to generate a symmetry; in the case of the Potts models this symmetry enhances to the full premutation group on the local Hilbert space. One has to be careful when dealing with non-abelian symmetries: however, if one is only interested in the ground state sector, then the non-abelian nature of the symmetries is not actually important.</p>
<section id="symmetry-map-s-n-sign-ptr-args">
<h3><cite>symmetry_map(s, N, sign_ptr, args)</cite><a class="headerlink" href="#symmetry-map-s-n-sign-ptr-args" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><cite>s</cite>: quantum state in integer representation.</p></li>
<li><p><cite>N</cite>: the total number of lattice sites.</p></li>
<li><p><cite>sign_ptr</cite>: a pointer to a number which one can use to pass sign changes back to QuSpin; used for fermion systems.</p></li>
<li><p><cite>args</cite>: a <cite>np.ndarray</cite> of the same data type as the <cite>user_basis</cite>. Can be used to pass optional arguments, e.g. <cite>sps</cite> in the case of bosons.</p></li>
</ul>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>all four arguments must be present in the function, even if some are not used (this is required to keep the syntax general for all particle species).</p></li>
</ul>
</section>
<section id="system-size-independent-symmetries">
<h3>System-size independent symmetries<a class="headerlink" href="#system-size-independent-symmetries" title="Link to this heading"></a></h3>
<p>System-size independent symmetries contain as a parameter the system size <span class="math notranslate nohighlight">\(N\)</span>. As a result, they apply to all system sizes. Examples of such symmetries are</p>
<section id="parity-in-1d-for-any-system-size-n">
<h4>parity in 1d for any system size <cite>N</cite><a class="headerlink" href="#parity-in-1d-for-any-system-size-n" title="Link to this heading"></a></h4>
<p>Parity is the reflection of a state w.r.t. the middle of the chain.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">sign_ptr</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; works for all system sizes N, spin-1/2 only. &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span>
        <span class="c1">#</span>
        <span class="n">out</span> <span class="o">^=</span> <span class="p">(</span><span class="n">x</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
        <span class="k">while</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
                <span class="n">out</span> <span class="o">^=</span> <span class="p">(</span><span class="n">x</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
                <span class="n">s</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="c1">#</span>
        <span class="n">out</span> <span class="o">&lt;&lt;=</span> <span class="n">s</span>
        <span class="k">return</span> <span class="n">out</span>
</pre></div>
</div>
</section>
<section id="translation-in-1d-for-any-system-size-n">
<h4>translation in 1d for any system size <cite>N</cite><a class="headerlink" href="#translation-in-1d-for-any-system-size-n" title="Link to this heading"></a></h4>
<p>We consider translation by <cite>shift=1</cite> sites, but the code can easily be generalized to a larger-shift translation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">translation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">sign_ptr</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; works for all system sizes N, spin-1/2 only. &quot;&quot;&quot;</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># translate state by shift sites</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">N</span> <span class="c1"># periodicity/cyclicity of translation</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="c1"># largest integer allowed to appear in the basis</span>
        <span class="c1">#</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="n">period</span><span class="p">)</span><span class="o">%</span><span class="n">period</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x2</span> <span class="o">|</span> <span class="n">x1</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="symmetries-for-fixed-system-sizes-using-precomputed-masks">
<h3>Symmetries for fixed system sizes using precomputed masks<a class="headerlink" href="#symmetries-for-fixed-system-sizes-using-precomputed-masks" title="Link to this heading"></a></h3>
<p>The convenience to define symmetry maps which apply to all system sizes comes at a cost of speed. This can be circumvented by defining system-size specific maps, using integer masks to perform the bit operations. These masks also depend on the data type of the integer storing the state.</p>
<p>Luckily, there is a great tool to compute the symmetry maps, available at <a class="reference external" href="http://programming.sirrida.de/calcperm.php">http://programming.sirrida.de/calcperm.php</a>. All one needs to do is find the permutation of the lattice sites under the symmetry, and pass it to the tool to obain the symmetry map that acts on integers. Let us demonstrate how this works using two examples.</p>
<section id="parity-in-1d-for-a-fixed-system-size-n-10">
<h4>parity in 1d for a fixed system size <cite>N=10</cite><a class="headerlink" href="#parity-in-1d-for-a-fixed-system-size-n-10" title="Link to this heading"></a></h4>
<p>Consider a ladder of <span class="math notranslate nohighlight">\(2\times 10\)</span> sites, labelled 0 through 19. The action of parity/reflection along the long ladder axis is easily defined on the lattice sites to be</p>
<div class="math notranslate nohighlight">
\[[0,\ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9;\ 10,\ 11,\ 12,\ 13,\ 14,\ 15,\ 16,\ 17,\ 18,\ 19] \mapsto [9,\ 8,\ 7,\ 6,\ 5,\ 4,\ 3,\ 2,\ 1,\ 0;\ 19,\ 18,\ 17,\ 16,\ 15,\ 14,\ 13,\ 12,\ 11,\ 10]\]</div>
<p>Passing the transformed integer sequence (right-hand side) to the online generator <a class="reference external" href="http://programming.sirrida.de/calcperm.php">http://programming.sirrida.de/calcperm.php</a>, it returns the symmetry map</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">sign_ptr</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; works for N=10 sites and 32 bit-integers, spin-1/2 states only &quot;&quot;&quot;</span>
    <span class="k">return</span>    <span class="p">(</span>  <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00004010</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00002008</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00001004</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00000802</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00000401</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00080200</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00040100</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00020080</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00010040</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span>
               <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00008020</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This map works only for this system size, and for 32-bit integers. However if one downloads the source code from the website, one can compile a program which generates these for larger integer data types.</p>
</section>
<section id="translation-in-1d-for-a-fixed-system-size-n-10">
<h4>translation in 1d for a fixed system size <cite>N=10</cite><a class="headerlink" href="#translation-in-1d-for-a-fixed-system-size-n-10" title="Link to this heading"></a></h4>
<p>Consider again a ladder of <span class="math notranslate nohighlight">\(2\times 10\)</span> sites, labelled 0 through 19. The action of translation along the long ladder axis is easily defined on the lattice sites to be</p>
<div class="math notranslate nohighlight">
\[[0,\ 1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9;\ 10,\ 11,\ 12,\ 13,\ 14,\ 15,\ 16,\ 17,\ 18,\ 19] \mapsto [1,\ 2,\ 3,\ 4,\ 5,\ 6,\ 7,\ 8,\ 9,\ 0;\ 11,\ 12,\ 13,\ 14,\ 15,\ 16,\ 17,\ 18,\ 19,\ 10]\]</div>
<p>corresponds to the bit operation (again, fixed system size and data type):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">translation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">sign_ptr</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; works for N=10 sites and 32 bit-integers spin-1/2 states only. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x0007fdff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x00080200</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="symmetry-maps-dictionary">
<h3>Symmetry <cite>maps</cite> dictionary<a class="headerlink" href="#symmetry-maps-dictionary" title="Link to this heading"></a></h3>
<p>In the <cite>user_basis</cite>, the functions encoding the symmetry action are referred to as maps. Every map has as its first argument the integer (state) to be tansformed, followed by the number of sites. For fermionic systems, the symmetry action can also modify the fermion sign of a given state. Therefore, the last argument is a <cite>sign_ptr</cite>.</p>
<p>Symmetries are passed to the <cite>user_basis</cite> constructor via a python dictionary, called <cite>maps</cite>. The keys are arbitrary strings which define a unique name for each map; the corresponding values are tuples of four entries: <cite>(map function, periodicity, quantum number, args)</cite>. The symmetry periodicity (or cyclicity, or multiplicity) is the smallest integer <span class="math notranslate nohighlight">\(m_Q\)</span>, such that <span class="math notranslate nohighlight">\(Q^{m_Q} = 1\)</span>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">maps</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">T_block</span><span class="o">=</span><span class="p">(</span><span class="n">translation</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">T_args</span><span class="p">),</span> <span class="n">P_block</span><span class="o">=</span><span class="p">(</span><span class="n">parity</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">P_args</span><span class="p">),</span> <span class="p">)</span>
</pre></div>
</div>
<p><strong>Notes</strong>:</p>
<ul class="simple">
<li><p>all map functions need to be cast as decorated numba cfuncs <strong>(SEE below)</strong>. The examples above are shown as python functions, so the user can test them in practice. Luckily, the same code can be used in numba.</p></li>
<li><p>even though some arguments of the map functions are not used in the function bodies, the user is required to include them in the functin definition (and no more!). This allows to keep the code general. The names of these arguments are arbitrary, but their data typs are <strong>not</strong>.</p></li>
</ul>
</section>
</section>
<section id="using-numba-to-pass-python-functions-to-the-c-user-basis-constructor">
<h2>Using <cite>numba</cite> to pass python functions to the C++ <cite>user_basis</cite> constructor<a class="headerlink" href="#using-numba-to-pass-python-functions-to-the-c-user-basis-constructor" title="Link to this heading"></a></h2>
<p>The function methods of <cite>user_basis</cite> discussed above, are passed to the <cite>user_basis</cite> constructor. Since the latter is written in <cite>C++</cite> for speed, we use  the (numba)[<a class="reference external" href="https://numba.pydata.org/">https://numba.pydata.org/</a>] package to decorate python functions which are automatically compiled to low level code that can then be called by the underlying QuSpin <cite>C++</cite> base code for the <cite>user_basis</cite>.</p>
<section id="data-types">
<h3>Data types<a class="headerlink" href="#data-types" title="Link to this heading"></a></h3>
<p>Unlike python, C++ code requires the user to specify the data types of all variables (so-called strong typing). For this purpose, numba supports various data types, e.g. <cite>uint32</cite>, or <cite>int32</cite>. They are typically imported from numba in the beginning of the python script.</p>
</section>
<section id="function-decorators">
<h3>Function decorators<a class="headerlink" href="#function-decorators" title="Link to this heading"></a></h3>
<p>To indicate that the function we wrote in python should be compiled as a C++ code by numba, we use the <cite>&#64;cfunc(signature,locals=dict())</cite> decorator. The arguments of the decorator are the function variable signature (which contains the data types of all function variables), and <cite>locals</cite> which is a dictionary containing the data types of all other variables defined and used privately inside the function body.</p>
<p>In QuSpin, we provide the signatures <cite>next_state_sig_32</cite>, <cite>op_sig_32</cite>, <cite>map_sig_32</cite>, <cite>count_particles_32</cite>; <cite>next_state_sig_64</cite>, <cite>op_sig_64</cite>, <cite>map_sig_64</cite>, <cite>count_particles_64</cite> which are compatible with the QuSpin base code. The name of the signature refers to the function type it is designed for, and the integer in the end specifies the data type the <cite>user_basis</cite> will be constructed with. These signatures can be imported from the <cite>user_basis</cite>.</p>
<p>As an example, consider the <cite>translation()</cite> python function defined above. To make this a <cite>numba.CFunc</cite> object, it suffices to place the decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quspin.basis.user</span> <span class="kn">import</span> <span class="n">map_sig_32</span> <span class="c1"># user basis data types</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">cfunc</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">uint32</span><span class="p">,</span><span class="n">int32</span> <span class="c1"># numba data types</span>
<span class="c1">#</span>
<span class="nd">@cfunc</span><span class="p">(</span><span class="n">map_sig_32</span><span class="p">,</span>
        <span class="nb">locals</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">shift</span><span class="o">=</span><span class="n">uint32</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">uint32</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="n">uint32</span><span class="p">,</span><span class="n">x2</span><span class="o">=</span><span class="n">uint32</span><span class="p">,</span><span class="n">period</span><span class="o">=</span><span class="n">int32</span><span class="p">,</span><span class="n">l</span><span class="o">=</span><span class="n">int32</span><span class="p">,)</span> <span class="p">)</span>
<span class="k">def</span> <span class="nf">translation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">sign_ptr</span><span class="p">,</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; works for all system sizes N. &quot;&quot;&quot;</span>
        <span class="n">shift</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># translate state by shift sites</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">N</span> <span class="c1"># periodicity/cyclicity of translation</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">shift</span><span class="o">+</span><span class="n">period</span><span class="p">)</span><span class="o">%</span><span class="n">period</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">period</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="n">l</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="c1">#</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x2</span> <span class="o">|</span> <span class="n">x1</span><span class="p">)</span>
</pre></div>
</div>
<p>We use the signature <cite>map_sig_32</cite> because it is designed to decorate symmetry map functions. Moreover, the local (private) variable data types are defined via <cite>locals=dict(shift=uint32,xmax=uint32,x1=uint32,x2=uint32,period=int32,l=int32,)</cite>. These variables appear in the function body.</p>
<p><strong>Notes</strong></p>
<ul class="simple">
<li><p>because QuSpin provides predefined CFunc signatures, every CFunc (see function methods above) has a predefined, <strong>fixed</strong> number of arguments. Moreover, the data types of the arguments is also fixed. Even if some arguments are not used in the CFunc body, they have to appear in the function definition.</p></li>
<li><p>if you mess up the data types, most likely you will receive a numba error. In such cases, we suggest that you remove the CFunc decorator and debug your function in python as you would normally do. Once you are confident that the function does its job, put back the decorator and pass it to the <cite>user_basis</cite> constructor.</p></li>
<li><p>Unfortunately <cite>numba</cite> will not allow printing inside CFuncs because of complications dealing with Python’s Global Interpreter Lock (GIL). Because of this, debugging these functions can be a bit tedious. Always make sure that your code performs properly by running it purely with python before attemping to use it within the <cite>user_basis</cite>.</p></li>
</ul>
</section>
</section>
<section id="example-scripts">
<h2>Example Scripts<a class="headerlink" href="#example-scripts" title="Link to this heading"></a></h2>
<p>Below, we provide examples which demonstrate how to use the <cite>user_basis</cite> class.</p>
<section id="scripts-to-construct-spin-fermion-and-boson-bases">
<h3>Scripts to construct spin, fermion, and boson bases<a class="headerlink" href="#scripts-to-construct-spin-fermion-and-boson-bases" title="Link to this heading"></a></h3>
<p>The following three examples demonstrate how the <cite>user_basis</cite> recovers the functionality of the <cite>basis_general</cite> classes:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../examples/user-basis_example0.html#user-basis-example0-label"><span class="std std-ref">spin-1/2 Heisenberg model in 1d</span></a>, <a class="reference download internal" download="" href="../downloads/13c39a4f288325f015e4c01c8f50b42f/user_basis_trivial-spin.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/user-basis_example1.html#user-basis-example1-label"><span class="std std-ref">spinless fermions with nearest-neighbor interactions in 1d</span></a>, <a class="reference download internal" download="" href="../downloads/708dfdc7c222619a8b4356ff303081ba/user_basis_trivial-spinless_fermion.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/user-basis_example2.html#user-basis-example2-label"><span class="std std-ref">Bose-Hubbard model in 1d</span></a>, <a class="reference download internal" download="" href="../downloads/a8cc2da808e7e933a1a237a531e70f53/user_basis_trivial-boson.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
</ul>
</section>
<section id="scripts-to-demonstrate-the-additional-functionality-introduced-by-the-user-basis">
<h3>Scripts to demonstrate the additional functionality introduced by the <cite>user_basis</cite><a class="headerlink" href="#scripts-to-demonstrate-the-additional-functionality-introduced-by-the-user-basis" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><a class="reference internal" href="../examples/example14.html#example14-label"><span class="std std-ref">Quantum scars Hamiltonian: spin-1/2 system with Hilbert space constraint</span></a>, <a class="reference download internal" download="" href="../downloads/ce24628b1934b1aacd9f1ac29dfbc30e/example14.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/example15.html#example15-label"><span class="std std-ref">Spin-1/2 system with sublattice particle consevation</span></a>, <a class="reference download internal" download="" href="../downloads/c6fb308e3731bcee1b7864776743455f/example15.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/example16.html#example16-label"><span class="std std-ref">Applying symmetries to reduce user-imported bases using QuSpin</span></a>, <a class="reference download internal" download="" href="../downloads/dbdd6400ff1ff3f244148fb3a442525e/example16.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/example23.html#example23-label"><span class="std std-ref">Gell-Mann Operators for Spin-1 systems</span></a>, <a class="reference download internal" download="" href="../downloads/25f20672070bc09359d1b2414896faed/example23.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
<li><p><a class="reference internal" href="../examples/example24.html#example24-label"><span class="std std-ref">Majorana Fermions: Spinless Fermi-Hubbard Model</span></a>, <a class="reference download internal" download="" href="../downloads/52293556b936bd2bddddce4265362036/example24.py"><code class="xref download docutils literal notranslate"><span class="pre">download</span> <span class="pre">script</span></code></a></p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="parallelization.html" class="btn btn-neutral float-left" title="Parallel computing support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../contribute/report_a_bug.html" class="btn btn-neutral float-right" title="Report a bug" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Phillip Weinberg, Markus Schmitt, and Marin Bukov.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6885KZ7NH6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-6885KZ7NH6', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>